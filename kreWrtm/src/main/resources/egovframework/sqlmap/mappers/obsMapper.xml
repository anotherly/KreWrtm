<?xml version="1.0" encoding="UTF-8"?>
<!-- 
수정일           수정자         수정내용 
========= ======= ================================================= 
2025.09.11 최다슬     최초 생성 
-->

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.hivesys.obs.mapper.ObsMapper">


	<resultMap type="obsVo" id="selectDataList">
		<result property="obsId" column="OBS_ID"/>
		<result property="carNum" column="CAR_NUM"/>
		<result property="rptDate" column="RPT_DATE"/>
		<result property="obsName" column="OBS_NAME"/>
		<result property="prcDate" column="PRC_DATE"/>
		<result property="prcComment" column="PRC_COMMENT"/>
		<result property="reason" column="REASON"/>
		<result property="etc" column="ETC"/>
	</resultMap>
	
	<!-- 장애이력 관리 목록 조회 -->
	<select id="selectDataList" parameterType="obsVo" resultMap="selectDataList">	
		SELECT * FROM TBL_OBS_INFO
		
		WHERE 1=1
		<if test="obsName != null and obsName != ''">
			AND OBS_NAME LIKE CONCAT('%', #{obsName}, '%')
		</if>
		<if test="carNum != null and carNum != ''">
			AND CAR_NUM LIKE CONCAT('%', #{carNum}, '%')
		</if>
		<if test="sDate !=null and sDate neq '' and eDate !=null and eDate neq '' ">
			AND <![CDATA[ RPT_DATE >= #{sDate} AND RPT_DATE <= #{eDate} ]]>
		</if>
		<if test="ssDate !=null and ssDate neq '' and eeDate !=null and eeDate neq '' ">
			AND <![CDATA[ PRC_DATE >= #{ssDate} AND PRC_DATE <= #{eeDate} ]]>
		</if>
		
		ORDER BY RPT_DATE
	</select>


	<!-- 장애이력 관리 상세 정보 조회 -->
	<select id="selectData" parameterType="obsVo" resultMap="selectDataList">
		SELECT * FROM TBL_OBS_INFO
		WHERE OBS_ID = #{obsId}	
	</select>
	
	
	<!-- 장애이력 관리 등록 -->
	<insert id="insertData" parameterType="obsVo">
		INSERT INTO TBL_OBS_INFO
		VALUES(#{obsId},#{carNum},#{rptDate},#{obsName},#{prcDate},#{prcComment},#{reason},#{etc})	
	</insert>
	
	
	<!-- 장애이력 관리 수정 -->
	<update id="updateObs" parameterType="obsVo">
		UPDATE TBL_OBS_INFO SET		
			CAR_NUM = #{carNum},
			RPT_DATE = #{rptDate},
			OBS_NAME = #{obsName},
			PRC_DATE = #{prcDate},
			PRC_COMMENT = #{prcComment},
			REASON = #{reason},
			ETC = #{etc}
		WHERE OBS_ID = #{obsId}
	</update>
	

	<!-- 장애이력 관리 삭제 -->
	<delete id="deleteData" parameterType="obsVo">
		DELETE FROM TBL_OBS_INFO 
		WHERE OBS_ID IN
		<foreach collection="chkList" item="item" index="index" separator="," open="(" close=")">
            #{item}
        </foreach>
	</delete> 


</mapper>